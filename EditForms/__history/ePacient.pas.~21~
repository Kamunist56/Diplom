unit ePacient;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants,
  System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, cSmallTables, cPolis, cPlace, cSector,
   cAdress, Vcl.StdCtrls, Vcl.DBCtrls, Vcl.ComCtrls, Vcl.ExtCtrls,
  cPac;

type
  TPacientEdit = class(TForm)
    GroupBox1: TGroupBox;
    Label2: TLabel;
    Label4: TLabel;
    LookLoc: TDBLookupComboBox;
    LookHouse: TDBLookupComboBox;
    Label3: TLabel;
    Label5: TLabel;
    LookArea: TDBLookupComboBox;
    LookStreet: TDBLookupComboBox;
    Button2: TButton;
    GroupBox2: TGroupBox;
    Label1: TLabel;
    Label8: TLabel;
    Label9: TLabel;
    Label11: TLabel;
    Label12: TLabel;
    LabeledEdit1: TLabeledEdit;
    LabeledEdit2: TLabeledEdit;
    LabeledEdit3: TLabeledEdit;
    DateTimePicker1: TDateTimePicker;
    LookPolikl: TDBLookupComboBox;
    LookSector: TDBLookupComboBox;
    LookPolisType: TDBLookupComboBox;
    Edit1: TEdit;
    GroupBox3: TGroupBox;
    Label6: TLabel;
    Label7: TLabel;
    Label10: TLabel;
    LookSoc: TDBLookupComboBox;
    LookWork: TDBLookupComboBox;
    LookGroup: TDBLookupComboBox;
    procedure Button2Click(Sender: TObject);
    procedure LookSocCloseUp(Sender: TObject);
  private
    Pacient: TPacient;
    Soc: TSmallTables;
    Polis: TPolis;
    Adr: TAdress;
    Work: TSmallTables;
    Sector: TSector;
    Polikl: TPlace;
    procedure AddPac;

    { Private declarations }
  public
    { Public declarations }
  end;

var
  PacientEdit: TPacientEdit;

implementation

{$R *.dfm}

uses fDM;

procedure TPacientEdit.AddPac;
var
  id: Integer;
begin
  //определяем поликлинику
  Polikl:=TPlace.Create('Polikl');
  polikl.Get(LookPolikl.KeyValue);

  // участок
  Sector:=TPlace.Create('Sector');
  Sector.Get(LookSector.KeyValue);

  // создаем новый полис
  polis:=TPolis.Create;
  Polis.PolisNumber:=Edit1.Text;
  Polis.PolisType.GetAtr(LookPolisType.KeyValue);
  polis.new;
  // создали схватили последний id для полиса
  id:=Dm.GetLastId('Polis');
  polis.Get(id);

  // Адрес
  Adr:=TAdress.Create;
  Adr.Loc.GetAtr(LookLoc.KeyValue);
  Adr.Ar.GetAtr(LookArea.KeyValue);
  Adr.Street.GetAtr(LookStreet.KeyValue);
  Adr.House_numb.GetAtr(LookHouse.KeyValue);
  Adr.New;
  // социальный статус



  Pacient := TPacient.Create;
  with Pacient do
  Begin
    surname := LabeledEdit1.Text;
    name := LabeledEdit2.Text;
    patronymic := LabeledEdit3.Text;
    date_birth := DateTimePicker1.Date;
    Soc.id:=LookSoc.KeyValue;
    polis:=PacientEdit.Polis;
    Adress:=PacientEdit.Adr;
  End;
end;

procedure TPacientEdit.Button2Click(Sender: TObject);
begin
  AddPac;
end;

procedure TPacientEdit.LookSocCloseUp(Sender: TObject);
begin
  if LookSoc.KeyValue=5 then
    LookGroup.Enabled:= not LookGroup.Enabled;

end;

end.
