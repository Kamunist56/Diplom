unit cVisit;

interface
uses cpac, cDoctor, cDiagnoses, fDM;

type
 TVisit =Class
   public
   id:integer;
   dateVisit:Tdate;
   Pac:TPacient;
   Doc:TDoctor;
   Diag:TDiagnoses;

   procedure Get(Find_id:integer);
   procedure New(Visit:TVisit);
   procedure Change(Visit:TVisit);
   procedure Del(Visit:TVisit);
 End;

implementation

{ TVisit }

procedure TVisit.Change(Visit: TVisit);
begin
     with dm.QVisit do
  begin
    close;
    sql.Add('update Visit ');
    sql.Add('set date=:date, pac=:pac, doctor=:doctor, diagnos=:diagnos)');
    parameters.ParamValues['id']:=Visit.id;
    parameters.ParamValues['date']:=dateVisit;
    parameters.ParamValues['pac']:=pac.id;
    parameters.ParamValues['doctor']:=doc.id;
    parameters.ParamValues['diagnos']:=diag.id;
    ExecSQl;
    open;
  end;
end;

procedure TVisit.Del(Visit: TVisit);
begin
    with dm.QVisit do
  begin
    close;
    sql.Add('delete Visit where id=:id');
    parameters.ParamValues['id']:=visit.id;
    ExecSQL;
  end;
end;

procedure TVisit.Get(Find_id: integer);
begin
  with dm.QVisit do
  begin
    close;
    sql.Add('select date, pac, doctor, diagnos from Visit where id=:id');
    parameters.ParamValues['id']:=Find_id;
    open;
  end;
    dateVisit:=dm.QVisit.FieldByName('date').AsDateTime;
    pac:=TPacient.Create;
    pac.GetAtr(dm.QVisit.FieldByName('pac').AsInteger);
    doc:=TDoctor.Create;
    doc.GetAtr(dm.QVisit.FieldByName('doctor').AsInteger);
    diag:=Tdiagnoses.Create;
    diag.GetAtr(dm.QVisit.FieldByName('diagnos').AsInteger);

end;

procedure TVisit.New(Visit: TVisit);
begin
   with dm.QVisit do
  begin
    close;
    sql.Add('insert Visit (date, pac, doctor, diagnos)');
    sql.Add('values (:date, :pac, :doctor, :diagnos)');
    parameters.ParamValues['date']:=dateVisit;
    parameters.ParamValues['pac']:=pac.id;
    parameters.ParamValues['doctor']:=doc.id;
    parameters.ParamValues['diagnos']:=diag.id;
    ExecSQl;
//    parameters.ParamValues['id']:=Visit.id;
    open;
  end;
end;

end.
