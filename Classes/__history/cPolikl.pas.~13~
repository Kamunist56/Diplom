unit cPlace;

interface

{ класс для работы с Polikl, Stat_work }
Type
  TPlace = Class
  public
    id: integer;
    name: String;
    adress: String;
    id_adress: integer;
    tableName:String;

    procedure Get(find_id:integer;table:String);
    procedure New(Place: TPlace);
    procedure ChangeAtr(Place: TPlace);
    procedure Del(Place:TPlace);
  End;

implementation

{ TPlace }

uses fDM, cAdress;

var
  Adr: Tadress;

procedure TPlace.ChangeAtr(Place: TPlace);
begin
    with dm.QPlace do
  begin
    close;
    sql.add('update :tableName set name=:name, adress=:adress) where id=:id');
    Parameters.paramvalues['tablename'] :=Place.tablename;
    Parameters.paramvalues['id'] :=Place.id;
    Parameters.paramvalues['name'] := Place.name;
    Parameters.paramvalues['adress'] := Place.id_adress;
    ExecSQL;
  end;
end;

procedure TPlace.Del(Place: TPlace);
begin
     with dm.QPlace do
  begin
    close;
    sql.add('delete :tableName where id=:id');
    Parameters.paramvalues['tablename'] :=Place.tablename;
    Parameters.paramvalues['id'] := Place.id;
    open;
  end;
end;

procedure TPlace.Get(find_id:integer;table:String);
var idadr:integer;
begin
  with dm.QPlace do
  begin
    close;
    sql.add('select name, adress from :tableName where id=:id');
    Parameters.paramvalues['tablename'] :=table;
    Parameters.paramvalues['id'] := find_id;
    TableName:=table;
    open;
  end;
  idadr:=dm.QPlace.FieldByName('id').asinteger;

  Adr := adr.Create;
  Adr.GetAtr(idadr);
  adress := Adr.GetFullAdress;
  name := dm.QPlace.FieldByName('name').asString;
  id := find_id;
  id_adress := Adr.id;
end;

procedure TPlace.New(Place: TPlace);
begin
  with dm.QPlace do
  begin
    close;
    sql.add('insert :tableName (name, adress) values (:name, :adress)');
    Parameters.paramvalues['name'] := Place.name;
    Parameters.paramvalues['adress'] := Place.id_adress;
    ExecSQL;
  end;
end;

end.
