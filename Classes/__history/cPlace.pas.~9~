unit cPlace;

interface

uses fDM, cAdress;

{ класс для работы с Polikl, Stat_work }
Type
  TPlace = Class
  public
    id: integer;
    name: String;
    adress: TAdress;

    procedure Get(find_id: integer);
    procedure New;
    procedure ChangeAtr;
    procedure Del(id: integer);
    constructor Create(Table: String);
    destructor Destroy;

  private
    TableName: String;
  End;

implementation

{ TPlace }

procedure TPlace.ChangeAtr(Place: TPlace);
begin
  with dm.QPlace do
  begin
    close;
    SQL.Clear;
    SQL.add('update ' + Place.TableName +
      ' set name=:name, adress=:adress) where id=:id');
    Parameters.paramvalues['id'] := Place.id;
    Parameters.paramvalues['name'] := Place.name;
    Parameters.paramvalues['adress'] := adress.id;
    ExecSQL;
  end;
end;

constructor TPlace.Create(Table: String);
begin
  adress := TAdress.Create;
  TableName := Table;
end;

procedure TPlace.Del(Place: TPlace);
begin
  with dm.QPlace do
  begin
    close;
    SQL.Clear;
    SQL.add('delete '+TableName+' where id=:id');
    Parameters.paramvalues['id'] := id;
    open;
  end;
end;

destructor TPlace.Destroy;
begin
  adress.Destroy;
  inherited;
end;

procedure TPlace.Get(find_id: integer; Table: String);
var
  idadr: integer;
begin
  with dm.QPlace do
  begin
    close;
    SQL.Clear;
    SQL.add('select name, adress from ' +TableName +' where id=:id');
      Parameters.paramvalues['id'] := find_id;
    open;
  end;
  idadr := dm.QPlace.FieldByName('id').asinteger;

  adress.GetAtr(idadr);
  name := dm.QPlace.FieldByName('name').asString;
  id := find_id;
end;

procedure TPlace.New(Place: TPlace);
begin
  with dm.QPlace do
  begin
    close;
    SQL.Clear;
    SQL.add('insert :tableName (name, adress) values (:name, :adress)');
    Parameters.paramvalues['tablename'] := Place.TableName;
    Parameters.paramvalues['name'] := Place.name;
    Parameters.paramvalues['adress'] := adress.id;
    ExecSQL;
  end;
end;

end.
